{{~#*inline "answers_and_scores"~}}
  {{{json key="maxScore" value=(maths maxExpression scores=(pluck options "score"))}}},
  {{{json key="minScore" value=(maths minExpression scores=(pluck options "score"))}}},
  {{{json key="answers" value=(filter options "answer" "valueIn" answers)}}},
  {{{json key="score" value=(maths "sum(scores)" scores=(pluck (filter options "answer" "valueIn" answers) "score"))}}}
{{~/inline~}}

{{#json type="array"}}
  {{#each (getProperty @root.data.checkup @root.data.currentSite.name)}}
    {{#each questions}}
      {{#if metric}}
        {{#json type="object"}}
          {{{json key="metric" value=metric}}},
          {{#if @root.route.debugs}}
            {{{json key="section" value=@../key}}},
            {{{json key="question" value=(concat 'answers-' value)}}},
            {{{json key="path" value=(concat "@root.request.body." (concat 'answers-' @../key '-' value))}}},
          {{/if}}
          {{#compare type "===" "select-one"}}
            {{>answers_and_scores maxExpression="max(scores)" minExpression="min(scores)" options=options answers=(arrayify (lookup @root.request.body (concat 'answers-' @../key '-' value)))}}
          {{else}}
            {{#if options}}
              {{>answers_and_scores maxExpression="sum(filter(scores, isPositive))" minExpression="sum(filter(scores, isNegative))" options=options answers=(split (lookup @root.request.body (concat 'answers-' @../key '-' value)) ";")}}
            {{/if}}
          {{/compare}}
        {{/json}},
      {{/if}}
    {{/each}}
  {{/each}}
{{/json}}